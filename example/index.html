<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Visual Data Mapping - JSON Mapping - Object Mapping</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="my-mapping"></div>
<script src="bundle.js"></script>
<script>

const mockTarget = {
    'menu': {
        'id'   : 'file',
        'value': 'File',
        'popup': {
            'yyy'     : [
                {'value': 'Open', 'onclick': 'OpenDoc()'},
                {'value': 'Close', 'onclick': 'CloseDoc()'}
            ],
            'menuitem': [
                [
                    [
                        {'value': 'Open', 'onclick': 'OpenDoc()'},
                        {'value': 'Close', 'onclick': 'CloseDoc()'}
                    ]
                ]
            ]
        },
        'xxx'  : [
            [
                {'value': 'New', 'onclick': 'CreateNewDoc()'}
            ],
            [
                {'value': 'Open', 'onclick': 'OpenDoc()'},
                {'value': 'Close', 'onclick': 'CloseDoc()'}
            ]
        ]
    }
}
//
//


const mockSource = {
    'web-app': {
        'servlet'        : [
            {
                'servlet-name' : 'cofaxCDS',
                'servlet-class': 'org.cofax.cds.CDSServlet',
                'init-param'   : {
                    'configGlossary:installationAt': 'Philadelphia, PA',
                    'configGlossary:adminEmail'    : 'ksm@pobox.com',
                    'configGlossary:poweredBy'     : 'Cofax',
                    'configGlossary:poweredByIcon' : '/images/cofax.gif',
                    'configGlossary:staticPath'    : '/content/static',
                    'templateProcessorClass'       : 'org.cofax.WysiwygTemplate',
                    'templateLoaderClass'          : 'org.cofax.FilesTemplateLoader',
                    'templatePath'                 : 'templates',
                    'templateOverridePath'         : '',
                    'defaultListTemplate'          : 'listTemplate.htm',
                    'defaultFileTemplate'          : 'articleTemplate.htm',
                    'useJSP'                       : false,
                    'jspListTemplate'              : 'listTemplate.jsp',
                    'jspFileTemplate'              : 'articleTemplate.jsp',
                    'cachePackageTagsTrack'        : 200,
                    'cachePackageTagsStore'        : 200.123,
                    'cachePackageTagsRefresh'      : 60,
                    'cacheTemplatesTrack'          : 100,
                    'cacheTemplatesStore'          : 50,
                    'cacheTemplatesRefresh'        : 15,
                    'cachePagesTrack'              : 200,
                    'cachePagesStore'              : 100,
                    'cachePagesRefresh'            : 10,
                    'cachePagesDirtyRead'          : 10,
                    'searchEngineListTemplate'     : 'forSearchEnginesList.htm',
                    'searchEngineFileTemplate'     : 'forSearchEngines.htm',
                    'searchEngineRobotsDb'         : 'WEB-INF/robots.db',
                    'useDataStore'                 : true,
                    'dataStoreClass'               : 'org.cofax.SqlDataStore',
                    'redirectionClass'             : 'org.cofax.SqlRedirection',
                    'dataStoreName'                : 'cofax',
                    'dataStoreDriver'              : 'com.microsoft.jdbc.sqlserver.SQLServerDriver',
                    'dataStoreUrl'                 : 'jdbc:microsoft:sqlserver://LOCALHOST:1433;DatabaseName=goon',
                    'dataStoreUser'                : 'sa',
                    'dataStorePassword'            : 'dataStoreTestQuery',
                    'dataStoreTestQuery'           : 'SET NOCOUNT ON;select test=\'test\';',
                    'dataStoreLogFile'             : '/usr/local/tomcat/logs/datastore.log',
                    'dataStoreInitConns'           : 10,
                    'dataStoreMaxConns'            : 100,
                    'dataStoreConnUsageLimit'      : 100,
                    'dataStoreLogLevel'            : 'debug',
                    'maxUrlLength'                 : 500
                }
            },
            {
                'servlet-name' : 'cofaxEmail',
                'servlet-class': 'org.cofax.cds.EmailServlet',
                'init-param'   : {
                    'mailHost'        : 'mail1',
                    'mailHostOverride': 'mail2'
                }
            },
            {
                'servlet-name' : 'cofaxAdmin',
                'servlet-class': 'org.cofax.cds.AdminServlet'
            },

            {
                'servlet-name' : 'fileServlet',
                'servlet-class': 'org.cofax.cds.FileServlet'
            },
            {
                'servlet-name' : 'cofaxTools',
                'servlet-class': 'org.cofax.cms.CofaxToolsServlet',
                'init-param'   : {
                    'templatePath'       : 'toolstemplates/',
                    'log'                : 1,
                    'logLocation'        : '/usr/local/tomcat/logs/CofaxTools.log',
                    'logMaxSize'         : '',
                    'dataLog'            : 1,
                    'dataLogLocation'    : '/usr/local/tomcat/logs/dataLog.log',
                    'dataLogMaxSize'     : '',
                    'removePageCache'    : '/content/admin/remove?cache=pages&id=',
                    'removeTemplateCache': '/content/admin/remove?cache=templates&id=',
                    'fileTransferFolder' : '/usr/local/tomcat/webapps/content/fileTransferFolder',
                    'lookInContext'      : 1,
                    'adminGroupID'       : 4,
                    'betaServer'         : true
                }
            }],
        'servlet-mapping': {
            'cofaxCDS'   : '/',
            'cofaxEmail' : '/cofaxutil/aemail/*',
            'cofaxAdmin' : '/admin/*',
            'fileServlet': '/static/*',
            'cofaxTools' : '/tools/*'
        },

        'taglib': {
            'taglib-uri'     : 'cofax.tld',
            'taglib-location': '/WEB-INF/tlds/cofax.tld'
        }
    }
}

const instance = new DataMappingBundle.JsonMapping({
    container                      : 'my-mapping',
    target                         : mockTarget,
    shortenTarget                  : true,
    targetTreeReadOnly             : false,
    source                         : mockSource,
    shortenSource                  : true,
    disableChildWhenParentHasSource: true,
    indent                         : 15,
    windowProp                     : 'myJM',
    popupAttach                    : undefined,
    text                           : {
        tabMapping           : 'Mapping',
        tabOutput            : 'Output',
        tabOptions           : 'Options',
        editTargetBtn        : 'Edit Target',
        importTargetBtn      : 'Import Target (JSON)',
        viewSourceBtn        : 'View Source',
        importSourceBtn      : 'Import Source (JSON)',
        theadTargetTitle     : 'Target Object',
        theadSourceTitle     : 'Source Object',
        theadCol1            : 'Fields',
        theadCol2            : 'Value Type',
        theadCol3            : 'Value Type',
        theadCol4            : 'Fields',
        theadCol5            : 'Transform Data',
        theadCol6            : 'Default Value',
        outputTitle          : 'Output',
        codeTitle            : 'Code',
        resetOptionsBtn      : 'Reset To Default',
        loadCurrentOptionsBtn: 'Load Current Options',
        applyOptionsBtn      : 'Apply',
        popupTargetTitle     : 'Target',
        importTargetTitle    : 'Target Import',
        expandCollapseBtn    : 'Expand / Collapse',
        closeTargetPopupBtn  : 'âœ•',
        doImportTargetBtn    : 'Import',
        popupSourceTitle     : 'Source',
        importSourceTitle    : 'Source Import',
        closeSourcePopupBtn  : 'âœ•',
        doImportSourceBtn    : 'Import',
        sourceFilterIcon     : 'ðŸ”Ž',
        rowClearInputBtn     : 'âœ•',
        rowSelectPathBtn     : 'â‰¡',
        rowAddPathBtn        : '+',
        rowRemovePathBtn     : 'âˆ’',
        dataTypeCombined     : '...',
        copyBtn              : 'copy'
    }
})

instance.on('change', (targetSchema, sourceSchema, mappingFields, code) => {
    console.log('change')
    console.log(targetSchema)
    console.log(sourceSchema)
    console.log(mappingFields)
    console.log(code)
})
instance.on('output', (data) => {
    console.log('output')
    console.log(data)
})
instance.on('targetImport', obj => {
    console.log('target-import')
    console.log(obj)
})
instance.on('sourceImport', obj => {
    console.log('source-import')
    console.log(obj)
})
instance.on('configs', (oldConf, newConf) => {
    console.log('configs')
    console.log(oldConf)
    console.log(newConf)
})

// document.getElementById('update-config-btn')?.addEventListener('click', () => {
//     instance.setConfigs(...)
// })
//
// OR
//
// window.myJM.setConfigs(...)

// document.getElementById('destroy-btn')?.addEventListener('click', () => {
//     instance.destroy()
// })
//
// OR
//
// window.myJM.destroy()

// document.getElementById('execute-btn')?.addEventListener('click', () => {
//     const data = instance.execute()
// })
//
// OR
//
// window.myJM.execute()

</script>
</body>
</html>